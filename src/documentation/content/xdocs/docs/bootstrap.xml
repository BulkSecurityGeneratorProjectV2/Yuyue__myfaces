<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V1.2//EN" "document-v12.dtd">

<document>

<header>
    <title>Apache MyFaces - Bootstrap Build</title>
</header>

<body>

<section>
<title>Bootstrap build</title>

    <p>
        The following instructions are for the setup and usage of the bootstrap.xml build file.  This file is an Ant script 
        which can be used to generate and publish the nightly builds using the latest SVN code.  It is also used to build 
        and sign the release builds.  Finally, this file is used to automatically generate the website using the latest 
        xdocs, javadoc and tlddoc from SVN.
    </p>  
    <ul>
        <li>
            Install 
            <link href="http://ant.apache.org">Ant</link>.
            Make sure the ant binary is part of the <code>$PATH</code>.
        </li>
    </ul>
    <ul>
        <li>
            Download the jsch.jar from 
            <link href="http://wwww.jcraft.com/jsch">jcraft</link> 
            and copy to <code>$ANT_HOME/lib</code>.  This is necessary to allow scp to the destination server.
        </li>
    </ul>
    <ul>
        <li>
            Download the jsvn.jar from 
            <link href="http://jsvn.alternatecomputing.com/">alternatecomputing.com</link> 
            and copy to <code>$ANT_HOME/lib</code>.  This is necessary to allow ant to use SVN to retrieve the source code.
        </li>
    </ul>    
    
    
    
    <ul>
        <li>
            Install  
            <link href="http://subversion.tigris.org/">SVN</link>.  
            Make sure the svn binary is part of the <code>$PATH</code>.
        </li>
    </ul>
    <ul>
        <li>
            Create a directory for creating the nightly/release builds.
        </li>
    </ul>
    <ul>
        <li>
            Copy the <code>bootstrap.xml</code> file and <code>bootstrap.properties</code> files to this directory.  
            These files should work without any changes.  Currently these files are located in the SVN repository in 
            the <code>build</code> directory.  Copy the <code>bootstrap.properties.local.sample</code> 
            file to this directory as well.  Rename this file to <code>bootstrap.properties.local</code>.  Change the 
            username and password in this file to a valid username and password for the destination server.
        </li>
    </ul>
    <ul>
        <li>
            You can perform the nightly build manually from the command line using: <br/>
            <code>ant -buildfile bootstrap.xml clean nightly</code>
        </li>
    </ul>
    <ul>
        <li>
            You can perform the release build manually from the command line using: <br/>
            <code>ant -buildfile bootstrap.xml -Dbuild.version=1_0_9 clean nightly</code>
            <note label="NOTE">       
                The release target requires that the source be tagged as rel_x where build.version = x.  You should also 
                update the manifest.properties in the build directory before checking out.  The value of manifest.impl.version 
                will be used in the bundle filenames.  (Ex. <code>manifest.impl.version=1.0.9</code> yields a filename of 
                <code>myfaces-1.0.9.tgz</code>)
            </note>
        </li>
    </ul>
    <ul>
        <li>
            A cron job similar to the following should be used on the destination server to purge files older than five days <br/>
            <code>03 04 * * * find /www/cvs.apache.org/builds/myfaces/nightly -mtime +5 -exec rm {\} \; >/dev/null 2>&amp;1</code>
        </li>
    </ul>    
    <ul>
        <li>
            A cron job also needs to be added to the machine performing the nightly build <br/>
            <code>00 23 * * * ant -buildfile /home/sjs4/bootstrap/bootstrap.xml -logger org.apache.tools.ant.listener.MailLogger clean nightly >/dev/null 2>&amp;1</code>
        </li>
    </ul>        
    <ul>
        <li>
            A cron job also needs to be added to the machine performing the preiodic website build <br/>
            <code>45 0-23/4 * * * ant -buildfile /home/sjs4/bootstrap/bootstrap.xml -logger org.apache.tools.ant.listener.MailLogger clean publish-site >/dev/null</code>
        </li>
    </ul>            
    <ul>
        <li>
            A cron job is also needed on the desitnation server to make sure the website is updated from SVN <br/>
            <code>15 * * * * /home/schof/site-update.sh >/dev/null</code>
        </li>
    </ul>            

</section>

</body>
    
<footer>
    	<legal>Java, J2EE, and JCP are trademarks or registered trademarks of Sun Microsystems, Inc. in the United States and other countries.<br />
	&copy; 2004, Apache Software Foundation
	</legal>
</footer>

</document>
