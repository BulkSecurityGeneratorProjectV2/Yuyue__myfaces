<?xml version="1.0" encoding="iso-8859-1"?>
<project name="myfaces" default="all">

    <!-- Manifest-Infos -->
    <property name="manifest.impl.title" value="MyFaces"/>
    <property name="manifest.impl.version" value="0.1.4"/>
    <property name="manifest.impl.vendor" value="MyFaces Project Team"/>

    <property name="project.dir" value="${basedir}"/>

    <property environment="env"/>

    <!-- dir for temporary files -->
    <property name="temp.dir" value="${project.dir}/temp"/>

    <!-- source dir for compiling -->
    <property name="src.dir" value="${project.dir}\src"/>

    <!-- WEB-INF dir -->
    <property name="web-inf.dir" value="${project.dir}/web/WEB-INF"/>

    <!-- destination dir for compiling -->
    <property name="classes.dir" value="${project.dir}/web/WEB-INF/classes"/>

    <!-- compiletime libraries (servlet.jar) -->
    <property name="lib.dir" value="${project.dir}/lib"/>

    <!-- examples dir -->
    <property name="examples.dir" value="${project.dir}/examples"/>

    <!-- path to the "jsf-api.jar" file -->
    <property name="jsf-api.file" value="${web-inf.dir}/lib/jsf-api.jar"/>

    <!-- allow some of the properties to be overridden -->
    <property file="build.properties"/>

    <!-- classpath for compiling -->
    <path id="project.class.path">
        <pathelement location="${jsf-api.file}" />
        <pathelement location="${web-inf.dir}/lib/mail.jar"/>
        <pathelement location="${lib.dir}/servlet.jar"/>
    </path>

    <target name="compile">
        <mkdir dir="${classes.dir}"/>
        <javac srcdir="${src.dir}/myfaces"
               destdir="${classes.dir}"
               optimize="off"
               classpathref="project.class.path">
        </javac>
        <javac srcdir="${src.dir}/example"
               destdir="${classes.dir}"
               optimize="off"
               classpathref="project.class.path">
        </javac>
    </target>

    <target name="-timestamp">
        <tstamp>
            <format property="TODAY_DE" pattern="dd.MM.yyyy HH:mm" locale="de"/>
        </tstamp>
    </target>

    <target name="jar" depends="compile, -timestamp">
        <mkdir dir="${temp.dir}"/>

        <manifest file="${temp.dir}/MANIFEST.MF">
            <attribute name="Built-By" value="${user.name}"/>
            <section name="myfaces.sourceforge.net">
              <attribute name="Implementation-Title" value="${manifest.impl.title}" />
              <attribute name="Implementation-Version" value="${manifest.impl.version} ${TODAY_DE}" />
              <attribute name="Implementation-Vendor" value="${manifest.impl.vendor}" />
            </section>
        </manifest>

        <jar destfile="${temp.dir}/myfaces.jar"
             manifest="${temp.dir}/MANIFEST.MF" >
            <fileset dir="${classes.dir}" includes="**"
                                          excludes=".dependency-info/**/*,
                                                    net/sourceforge/myfaces/example/**/*" />
            <fileset dir="${src.dir}/myfaces" includes="**"
                                              excludes="**/*.java"/>
        </jar>
    </target>

    <target name="examples-jar" depends="compile">
        <mkdir dir="${temp.dir}"/>
        <jar destfile="${temp.dir}/myfaces-examples.jar">
            <fileset dir="${classes.dir}"
                     includes="net/sourceforge/myfaces/example/**/*" />
            <fileset dir="${src.dir}/example"
                     includes="**"
                     excludes="**/*.java"/>
        </jar>
    </target>

    <target name="makeclean">
        <delete quiet="true" failonerror="false" includeEmptyDirs="true">
            <fileset dir="${classes.dir}"/>
            <fileset dir="${temp.dir}"/>
        </delete>
    </target>


    <target name="all" depends="jar,examples-jar"/>


    <target name="release" depends="makeclean,jar,examples-jar">
        <mkdir dir="${temp.dir}/api"/>
        <javadoc sourcepath="${src.dir}/myfaces"
                 destdir="${temp.dir}/api"
                 packagenames="net.sourceforge.myfaces.*"
                 classpathref="project.class.path"
                 failonerror="true" />
        <mkdir dir="${temp.dir}"/>
        <tar destfile="${temp.dir}/myfaces-${manifest.impl.version}.tgz"
             compression="gzip">
            <tarfileset dir="${project.dir}"
                        prefix="myfaces-${manifest.impl.version}"
                        excludes="web/WEB-INF/classes/**/*,
                                  temp/**,
                                  *.ipr,*.iws"/>
            <tarfileset dir="${temp.dir}/api"
                        prefix="myfaces-${manifest.impl.version}/doc/api" />
            <tarfileset dir="${temp.dir}"
                        includes="myfaces.jar,myfaces-examples.jar"
                        prefix="myfaces-${manifest.impl.version}/web/WEB-INF/lib"/>
        </tar>
    </target>



    <!--
    Convenient targets to deploy to tomcat (added by Bill Dudney [bdudney@mac.com]).
    See "tomcat-install-with-ant-readme.txt" for details.
    Comment out, if you do not have the necessary catalina-ant.jar file.
    -->
	<!-- must have 'catalina-ant.jar' in your ant class path for these to work. -->
    <taskdef name="list" classname="org.apache.catalina.ant.ListTask"/>
    <taskdef name="install" classname="org.apache.catalina.ant.InstallTask"/>
    <taskdef name="reload" classname="org.apache.catalina.ant.ReloadTask"/>
    <taskdef name="remove" classname="org.apache.catalina.ant.RemoveTask"/>

    <!-- these properties need to be overridable in a properties file -->
    <property name="tomcat.manager.url" value="http://localhost:8080/manager"/>
    <property name="tomcat.admin.user" value="admin"/>
    <property name="tomcat.admin.passwd" value="password"/>
    <property name="tomcat.example.context.path" value="/myFacesExample"/>

	<target name="list" description="List applications installed on tomcat" >
	  <list url="${tomcat.manager.url}" username="${tomcat.admin.user}"
	        password="${tomcat.admin.passwd}" />
	</target>

	<target name="install" description="Install example web application on tomcat"
	        depends="all">
	  <install url="${tomcat.manager.url}" username="${tomcat.admin.user}"
	           password="${tomcat.admin.passwd}"
               path="${tomcat.example.context.path}"
               war="file:${project.dir}/web" />
    </target>

	<target name="reload" description="Reload example web application on tomcat"
	        depends="all">
	  <reload  url="${tomcat.manager.url}" username="${tomcat.admin.user}"
	           password="${tomcat.admin.passwd}"
	           path="${tomcat.example.context.path}"/>
	</target>

    <target name="remove" description="Remove example web application from tomcat">
	  <remove url="${tomcat.manager.url}" username="${tomcat.admin.user}"
	          password="${tomcat.admin.passwd}"
	          path="${tomcat.example.context.path}"/>
	</target>

</project>
