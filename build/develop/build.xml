<?xml version="1.0" encoding="iso-8859-1"?>
<project name="myfaces-develop" default="prepare-for-debug">

    <property environment="env"/>

    <!-- Constants -->
    <property name="project.dir" location="${basedir}/../.."/>

    <!-- examples webapp-->
    <property name="examples.dir" location="${project.dir}/webapps/examples"/>
    <property name="examples.src" location="${project.dir}/webapps/src"/>
    <property name="examples.web" location="${examples.dir}"/>
    <property name="examples.doc" location="${examples.dir}/doc"/>
    <property name="examples.web-inf.classes.dir" location="${examples.web}/WEB-INF/classes"/>
    <property name="examples.web-inf.lib.dir" location="${examples.web}/WEB-INF/lib"/>

    <property name="myfaces.doc" location="${project.dir}/doc"/>
    <property name="share.src" location="${project.dir}/src/share"/>
    <property name="myfaces.src" location="${project.dir}/src/myfaces"/>
    <property name="components.src" location="${project.dir}/src/components"/>
    <property name="jsfapi.src" location="${project.dir}/src/jsfapi"/>
    <property name="tlds.dir" location="${project.dir}/tlds"/>

    <property name="tiles.dir" location="${project.dir}/webapps/tiles"/>
    <property name="tiles.web" location="${tiles.dir}/web"/>

    <!-- simple webapp -->
    <property name="simple.dir" location="${project.dir}/webapps/simple"/>
    <property name="simple.src" location="${project.dir}/webapps/src"/>
    <property name="simple.web" location="${simple.dir}"/>
    <property name="simple.doc" location="${simple.dir}/doc"/>
    <property name="simple.web-inf.classes.dir" location="${simple.web}/WEB-INF/classes"/>
    <property name="simple.web-inf.lib.dir" location="${simple.web}/WEB-INF/lib"/>

    <!-- Properties -->
    <property file="build.local.properties"/>
    <property file="build.default.properties"/>
    <property file="../build.local.properties"/>
    <property file="../build.default.properties"/>
    <property file="../manifest.properties"/>

    <!-- Temporary dir. May be overridden in build.properties -->
    <property name="temp.dir" location="${env.TEMP}"/>

    <!-- classpath for compiling api classes -->
    <path id="jsfapi.class.path">
        <pathelement location="${servlet-jsp.jar}"/>
        <pathelement location="${jsp-2.0.jar}"/>
        <pathelement location="${jstl.jar}"/>
    </path>

    <!-- classpath for compiling shared classes -->
    <path id="share.class.path">
        <pathelement location="${jsfapi.src}"/>
        <pathelement location="${servlet-jsp.jar}"/>
        <pathelement location="${jsp-2.0.jar}"/>
        <pathelement location="${jstl.jar}"/>
        <pathelement location="${commons-logging.jar}"/>
        <pathelement location="${commons-el.jar}"/>
    </path>

    <!-- classpath for compiling impl classes -->
    <path id="myfaces.class.path">
        <pathelement location="${jsfapi.src}"/>
        <pathelement location="${share.src}"/>
        <pathelement location="${servlet-jsp.jar}"/>
        <pathelement location="${jsp-2.0.jar}"/>
        <pathelement location="${jstl.jar}"/>
        <pathelement location="${commons-codec.jar}"/>    <!-- Base64 classes -->
        <pathelement location="${commons-logging.jar}"/>
        <pathelement location="${commons-digester.jar}"/>
        <pathelement location="${commons-beanutils.jar}"/>
        <pathelement location="${commons-el.jar}"/>
    </path>

    <!-- classpath for compiling component classes -->
    <path id="components.class.path">
        <pathelement location="${jsfapi.src}"/>
        <pathelement location="${share.src}"/>
        <pathelement location="${servlet-jsp.jar}"/>
        <pathelement location="${jsp-2.0.jar}"/>
        <pathelement location="${jstl.jar}"/>
        <pathelement location="${commons-logging.jar}"/>
        <pathelement location="${commons-el.jar}"/>
        <pathelement location="${commons-fileupload.jar}"/>
        <pathelement location="${commons-validator.jar}"/>
        <pathelement location="${commons-digester.jar}"/>        
    </path>

    <path id="examples.class.path">
        <!--pathelement location="${sun-jsf-api.jar}"/-->
        <pathelement location="${servlet-jsp.jar}"/>
        <pathelement location="${jsp-2.0.jar}"/>
        <pathelement location="${jstl.jar}"/>
        <pathelement location="${commons-logging.jar}"/>
        <pathelement location="${commons-digester.jar}"/>
        <pathelement location="${commons-el.jar}"/>
    </path>

    <target name="prepare-for-debug"
            description="copies needed config, TLD files and components-resources">

        <mkdir dir="${examples.web-inf.lib.dir}"/>

        <copy todir="${examples.web-inf.lib.dir}">
            <fileset file="${jstl.jar}"/>
            <!--fileset file="${jsp-2.0.jar}"/-->
            <fileset file="${commons-codec.jar}"/>
            <fileset file="${commons-logging.jar}"/>
            <!--fileset file="${commons-el.jar}"/-->
            <fileset file="${log4j.jar}"/>
            <fileset file="${commons-fileupload.jar}"/>
            <fileset file="${commons-validator.jar}"/>
            <fileset file="${jakarta-oro.jar}"/>
        </copy>
        <copy todir="${tiles.web}/WEB-INF/lib">
            <fileset file="${jstl.jar}"/>
            <fileset file="${commons-codec.jar}"/>
            <fileset file="${commons-logging.jar}"/>
            <fileset file="${log4j.jar}"/>
            <fileset file="${commons-fileupload.jar}"/>
            <fileset file="${commons-validator.jar}"/>
            <fileset file="${jakarta-oro.jar}"/>
        </copy>
        <copy todir="${simple.web-inf.lib.dir}">
            <fileset file="${jstl.jar}"/>
            <fileset file="${commons-codec.jar}"/>
            <fileset file="${commons-logging.jar}"/>
            <fileset file="${log4j.jar}"/>
            <fileset file="${commons-fileupload.jar}"/>
            <fileset file="${commons-validator.jar}"/>
            <fileset file="${jakarta-oro.jar}"/>
        </copy>


        <copy file="${project.dir}/conf/develop-web.xml" tofile="${examples.web}/WEB-INF/web.xml" />
        <copy file="${project.dir}/conf/tiles/develop-web.xml" tofile="${tiles.web}/WEB-INF/web.xml" />

        <copy file="${project.dir}/conf/faces-config.xml" todir="${examples.web}/WEB-INF" />
        <copy file="${project.dir}/conf/faces-config.xml" todir="${simple.web}/WEB-INF" />

        <!-- resolve TLD entities (for containers that do not support entities within TLDs) -->
        <xslt basedir="${tlds.dir}"
              includes="*.tld"
              destdir="${examples.web-inf.lib.dir}"
              style="${tlds.dir}/resolve_entities.xsl"
              extension=".tld">
             <xmlcatalog>
                 <dtd publicId="-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.2//EN"
                      location="${tlds.dir}/web-jsptaglibrary_1_2.dtd"/>
             </xmlcatalog>
        </xslt>
        <copy todir="${tiles.web}/WEB-INF/lib" >
            <fileset dir="${examples.web-inf.lib.dir}" includes="*.tld" />
        </copy>
        <copy todir="${simple.web}/WEB-INF/lib" >
            <fileset dir="${examples.web-inf.lib.dir}" includes="*.tld" />
        </copy>

    </target>



    <target name="compile-for-debug"
            depends="prepare-for-debug"
            description="compiles the myfaces and examples java classes to WEB-INF/classes and copies needed config and TLD files">

        <mkdir dir="${examples.web-inf.classes.dir}"/>

        <javac srcdir="${jsfapi.src}"
               destdir="${examples.web-inf.classes.dir}"
               optimize="off"
               debug="on"
               classpathref="jsfapi.class.path">
        </javac>

        <javac srcdir="${share.src}"
               destdir="${examples.web-inf.classes.dir}"
               optimize="off"
               debug="on"
               classpathref="share.class.path">
        </javac>

        <javac srcdir="${myfaces.src}"
               destdir="${examples.web-inf.classes.dir}"
               optimize="off"
               debug="on"
               classpathref="myfaces.class.path">
        </javac>

        <javac srcdir="${components.src}"
               destdir="${examples.web-inf.classes.dir}"
               optimize="off"
               debug="on"
               classpathref="components.class.path">
        </javac>

        <copy todir="${examples.web-inf.classes.dir}">
            <fileset dir="${myfaces.src}"
                     includes="**"
                     excludes="**/*.java
                               **/package.html"/>
        </copy>

        <javac srcdir="${examples.src}"
               destdir="${examples.web-inf.classes.dir}"
               optimize="off"
               debug="on"
               classpathref="examples.class.path">
        </javac>

        <copy todir="${examples.web-inf.classes.dir}">
            <fileset dir="${examples.src}"
                     includes="**"
                     excludes="**/*.java
                               **/package.html"/>
        </copy>

    </target>

    <target name="clean"
            description="deletes all files that were built">
        <delete quiet="true" failonerror="false" includeEmptyDirs="true">
            <fileset dir="${examples.web-inf.classes.dir}"/>
            <fileset dir="${examples.web-inf.lib.dir}"/>
            <fileset file="${examples.web}/WEB-INF/web.xml"/>
            <fileset file="${examples.web}/WEB-INF/faces-config.xml"/>
            <fileset file="${examples.web}/jscalendar"/>
            <fileset file="${examples.web}/jscookmenu"/>
        </delete>
        <delete quiet="true" failonerror="false" includeEmptyDirs="true">
            <fileset dir="${tiles.web}/WEB-INF/classes"/>
            <fileset dir="${tiles.web}/WEB-INF/lib"/>
            <fileset file="${tiles.web}/WEB-INF/web.xml"/>
            <fileset dir="${tiles.web}/jscalendar"/>
            <fileset dir="${tiles.web}/jscookmenu"/>
        </delete>
    </target>

    <target name="patch"
            description="Patch files from a diff file">
        <patch patchfile="${patchfile}"
               dir="${patchdir}"
               ignorewhitespace="true" />
    </target>


</project>