<?xml version="1.0" encoding="iso-8859-1"?>
<project name="myfaces-junit" default="junit" >

    <property environment="env"/>

    <!-- Constants -->
    <property name="project.dir" location="${basedir}/../.."/>
    <property name="junit.src.dir" location="${project.dir}/src/junit"/>

    <!-- Properties -->
    <property file="../build.local.properties"/>
    <property file="../build.default.properties"/>

    <!-- Temporary dir. May be overridden in build.properties -->
    <property name="temp.dir" location="${env.TEMP}"/>
    <property name="junit.classes.dir" location="${temp.dir}/myfaces/junit/classes"/>
    <property name="junit.results.dir" location="${test.results.dir}/junit"/>

    <!-- classpath for compiling -->
    <path id="junit.class.path">
        <pathelement location="${servlet.jar}"/>
        <pathelement location="${commons-el.jar}"/>
        <pathelement location="${jsp-api.jar}"/>
        <pathelement location="${myfaces.jar}"/>
        <pathelement location="${junit.jar}"/>
        <pathelement location="${commons-logging.jar}"/>
        <pathelement location="${junit.classes.dir}"/>
    </path>

    <target name="junit" depends="-compile-for-junit,-myfaces-jar">
        <mkdir dir="${junit.results.dir}/test-reports/xml"/>
        <mkdir dir="${junit.results.dir}/test-reports/html"/>
        <junit fork="true" printsummary="${test.printsummary}">
            <classpath refid="junit.class.path"/>
            <batchtest toDir="${junit.results.dir}/test-reports/xml">
                <fileset dir="${junit.classes.dir}">
                    <include name="**/*Test.class"/>
                    <exclude name="**/*BaseTest.class"/>
                </fileset>
            </batchtest>
            <formatter type="xml"/>
        </junit>
	    <junitreport>
	        <fileset dir="${junit.results.dir}/test-reports/xml">
		        <include name="TEST-*.xml"/>
		    </fileset>
		    <report toDir="${junit.results.dir}/test-reports/html"/>
	    </junitreport>
    </target>

	<target name="clean" description="deletes the generated test reports and compiled tests">
		<delete dir="${junit.results.dir}"/>
		<delete dir="${junit.classes.dir}"/>
	</target>


    <target name="-compile-for-junit" depends="-myfaces-jar" >
        <mkdir dir="${junit.classes.dir}"/>
        <javac srcdir="${junit.src.dir}"
               destdir="${junit.classes.dir}"
               debug="true"
               classpathref="junit.class.path">
        </javac>
        <copy todir="${junit.classes.dir}">
              <fileset dir="${junit.src.dir}">
                <include name="**/*.xml"/>
              </fileset>
        </copy>
    </target>


    <target name="-myfaces-jar" description="create myfaces.jar if necessary" >
        <available file="${myfaces.jar}" property="myfaces.jar.available"/>
        <antcall target="-create-myfaces-jar"/>
    </target>

    <target name="-create-myfaces-jar" unless="myfaces.jar.available"
            description="creates myfaces.jar via main buildfile" >
        <ant dir="${project.dir}/build" antfile="build.xml" target="myfaces-jar" inheritall="false"/>
    </target>


</project>