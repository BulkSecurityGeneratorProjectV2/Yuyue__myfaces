<?xml version="1.0" encoding="iso-8859-1"?>
<project name="myfaces-codegen" default="clean">

    <property environment="env"/>

    <!-- Constants -->
    <property name="project.dir" location="${basedir}/../.."/>
    <property name="codgen-src.dir" location="${project.dir}/src/codegen"/>
    <property name="jsfapi-src.dir" location="${project.dir}/src/jsfapi"/>
    <property name="myfaces-src.dir" location="${project.dir}/src/myfaces"/>
    <property name="components-src.dir" location="${project.dir}/src/components"/>

    <!-- Properties -->
    <property file="build.properties"/>
    <property file="../build.properties"/>
    <property file="../build.properties.default"/>
    <property file="../manifest.properties"/>

    <!-- Temporary dir. May be overridden in build.properties -->
    <property name="temp.dir" location="${env.TEMP}"/>
    <property name="codegen-classes.dir" location="${temp.dir}/myfaces-codegen"/>


    <!-- classpath for compiling -->
    <path id="codegen.class.path">
        <pathelement location="${ant.jar}"/>
        <pathelement location="${velocity.jar}"/>
        <pathelement location="${sun-jsf-api.jar}"/>
        <pathelement location="${codegen-classes.dir}"/>
    </path>

    <target name="-compile">
        <mkdir dir="${codegen-classes.dir}"/>
        <javac srcdir="${codgen-src.dir}"
               destdir="${codegen-classes.dir}"
               optimize="off"
               debug="on"
               classpathref="codegen.class.path">
        </javac>
        <copy todir="${codegen-classes.dir}">
            <fileset dir="${codgen-src.dir}"
                     includes="**"
                     excludes="**/*.java
                               **/package.html"/>
        </copy>
    </target>


    <target name="inspect-components" depends="-compile" >
        <taskdef name="inspect" classname="org.apache.myfaces.codegen.component.ComponentInspectorTask">
            <classpath refid="codegen.class.path"/>
        </taskdef>
        <inspect basedir="${jsfapi-src.dir}"
                 includes="javax/faces/component/UI*.java,
                           javax/faces/component/html/*.java"
                 excludes="javax/faces/component/UIComponent.java"
                 destdir="${jsfapi-src.dir}"
                 overwrite="false" />
    </target>

    <target name="generate-components" depends="-compile" >
        <taskdef name="generate" classname="org.apache.myfaces.codegen.component.ComponentGeneratorTask">
            <classpath refid="codegen.class.path"/>
        </taskdef>
        <generate basedir="${jsfapi-src.dir}"
                  includes="javax/faces/component/*.xml,
                            javax/faces/component/html/*.xml"
                  destdir="${jsfapi-src.dir}"
                  velocityLoaderPath="${codgen-src.dir}/org/apache/myfaces/codegen/resource" />
    </target>



    <target name="inspect-single-component" depends="-compile" >
        <taskdef name="inspect" classname="org.apache.myfaces.codegen.component.ComponentInspectorTask">
            <classpath refid="codegen.class.path"/>
        </taskdef>
        <inspect basedir="${jsfapi-src.dir}"
                 includes="${single-component}.java"
                 destdir="${jsfapi-src.dir}"
                 overwrite="true" />
    </target>

    <target name="generate-single-api-component" depends="-compile" >
        <taskdef name="generate" classname="org.apache.myfaces.codegen.component.ComponentGeneratorTask">
            <classpath refid="codegen.class.path"/>
        </taskdef>
        <generate basedir="${jsfapi-src.dir}"
                  includes="${single-component}.xml"
                  destdir="${jsfapi-src.dir}"
                  velocityLoaderPath="${codgen-src.dir}/org/apache/myfaces/codegen/resource" />
    </target>

    <target name="generate-single-impl-component" depends="-compile" >
        <taskdef name="generate" classname="org.apache.myfaces.codegen.component.ComponentGeneratorTask">
            <classpath refid="codegen.class.path"/>
        </taskdef>
        <generate basedir="${myfaces-src.dir}"
                  includes="${single-component}.xml"
                  destdir="${myfaces-src.dir}"
                  velocityLoaderPath="${codgen-src.dir}/org/apache/myfaces/codegen/resource" />
    </target>


    <target name="generate-all-components-components" depends="-compile" >
        <taskdef name="generate" classname="org.apache.myfaces.codegen.component.ComponentGeneratorTask">
            <classpath refid="codegen.class.path"/>
        </taskdef>
        <generate basedir="${components-src.dir}"
                  includes="org/apache/myfaces/component/html/ext/*.xml"
                  destdir="${components-src.dir}"
                  velocityLoaderPath="${codgen-src.dir}/org/apache/myfaces/codegen/resource" />
    </target>

    <target name="generate-single-components-component" depends="-compile" >
        <taskdef name="generate" classname="org.apache.myfaces.codegen.component.ComponentGeneratorTask">
            <classpath refid="codegen.class.path"/>
        </taskdef>
        <generate basedir="${components-src.dir}"
                  includes="${single-component}.xml"
                  destdir="${components-src.dir}"
                  velocityLoaderPath="${codgen-src.dir}/org/apache/myfaces/codegen/resource" />
    </target>


    <target name="clean"
        description="deletes all temporary files that were created">
        <delete quiet="true" failonerror="false" includeEmptyDirs="true">
            <fileset dir="${codegen-classes.dir}" />
            <fileset dir="${jsfapi-src.dir}"
                 includes="javax/faces/component/*.bak,
                           javax/faces/component/html/*.bak" />
        </delete>
    </target>


</project>